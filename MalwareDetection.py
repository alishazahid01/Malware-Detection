# Malware Detection from files and directories 
import os 

# Decorator function to print welcome and thank you messages
def print_message(func):
    def wrapper(*args, **kwargs):
        print("Welcome to Malware Detection!")
        result = func(*args, **kwargs)
        return result
    return wrapper

# Class for Malware Detection
class MalwareDetection:
    
    # Constructor
    def __init__(self,location,malware_signatures):
        self.location = location
        self.malware_signatures = malware_signatures

    # File Detection
    @ print_message
    def file_detection(self):
        print("Scanning File.....")
        # Reading file 
        with open (self.location, "rb") as file:
            content = file.read()
            # Checking malware signatures in file
            for signature in self.malware_signatures:
                if signature in content:
                    return True 
        return False
    
    # directory Detection
    @ print_message
    def dir_detection(self):
        print("Scanning Directory.....")
        # Checking each root, directories and files in the path
        # The purpose of os.walk() is to iterate over all files and directories in a given 
        for root, dirs, files in os.walk(self.location):
            for file_name in files:
                # To get the absolute path of the file, we use os.path.join()
                file_path = os.path.join(root, file_name)
                # Reading file 
                with open(file_path, "rb") as file:
                    content = file.read()
                    # Checking malware signatures in file
                    for signature in self.malware_signatures:
                        if signature in content:
                            return True, file_path
        return False, None

if __name__ == "__main__":

    # Load Signature of the Malware
    malware_signatures = [
        b'backdoor',
        b'trojan',
        b'keylogger'
    ]
    
    # Prompt user to enter location of file/dir
    location = input("Enter the path of the file/dir : ")

    # class object
    cls_obj = MalwareDetection(location,malware_signatures)

    # Check if the path is file or dir
    if os.path.isfile(location):
        malware_file = cls_obj.file_detection()

        # Checking 
        if malware_file:
            print(f"Malware Found in file {location}")

        else:
            print(f"Congrats malware not found in file {location}")

    elif os.path.isdir(location):
        malware_dir,file_path = cls_obj.dir_detection()

        # Checking 
        if malware_dir:
            print(f"Malware Found in file {file_path}")

        else:
            print(f"Congrats malware not found in file {file_path}")

    else:
        print("Path not exist")    
